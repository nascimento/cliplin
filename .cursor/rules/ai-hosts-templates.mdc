---
alwaysApply: true
---

## AI hosts: Cursor and Claude Desktop

When you change **templates** or **MCP-related commands** in this project, you MUST consider **all supported AI hosts** so configs stay consistent.

### Supported hosts

- **Cursor**: MCP config in `.cursor/mcp.json` → `mcpServers["cliplin-context"]`
- **Claude Desktop**: MCP config in `.mcp.json` at project root → `mcpServers["cliplin-context"]`; rules in `.claude/rules/`

### Rules

1. **Same MCP command for all hosts**  
   Use `"command": "uv", "args": ["run", "cliplin", "mcp"]` for both Cursor and Claude Desktop. Do not use bare `cliplin mcp` in generated configs (it can resolve to a global install and cause "No server info found" or wrong version).

2. **Update both config generators together**  
   MCP config is written by `create_cursor_mcp_config` and `create_claude_desktop_mcp_config` in `src/cliplin/utils/templates.py` (invoked from the integration handlers in `src/cliplin/utils/ai_host_integrations/`). If you change the MCP command, args, or env in one, change the other in the same edit. Do not update only Cursor or only Claude Desktop.

3. **New hosts**  
   If adding support for another MCP host (e.g. another IDE), add an integration class in `src/cliplin/utils/ai_host_integrations/` following the pattern in `docs/rules/ai-host-integration-handler-pattern.md`, use the same command pattern unless the host requires otherwise, and document the config path and quirks in `docs/rules/ai-host-integration.md`.

4. **Cross-project reference update**  
   When changing templates or solutions that affect a shared concept (e.g. MCP, context store, capability name, config path), follow `docs/rules/cross-references-on-evolution.md`: search the **entire project** for all references (other features in docs/features/, README, docs/business/, docs/adrs/, docs/rules/, other templates, .cursor/rules/) and update them so the project stays consistent. Do not leave features, docs, or other templates pointing at old wording or behavior.

5. **Feature → template verification**  
   When modifying a .feature file that has a template reflection (see `docs/rules/feature-template-mapping.md`), you MUST verify and update the corresponding template in `src/cliplin/utils/templates.py`. For example, knowledge.feature ↔ create_knowledge_packages_adr — any new subcommand or option in the feature must be reflected in the template.

### Reference

- Feature ↔ template mapping: `docs/rules/feature-template-mapping.md`
- Cross-host rules: `docs/rules/ai-host-integration.md`
- Cursor-specific: `docs/rules/cursor-integration.md`
- Claude Desktop-specific (incl. Skills): `docs/rules/claude-desktop-integration.md`
- Cross-project references on evolution: `docs/rules/cross-references-on-evolution.md`
- MCP server instructions: `docs/adrs/004-mcp-server-instructions.md`, `docs/rules/system-modules.md` (rule "MCP server must expose instructions")
